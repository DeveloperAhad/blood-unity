{% extends 'base/base.html' %}
{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        Contacts
                    </div>
                    <ul class="list-group list-group-flush">
                        <!-- Replace these list items with actual contact information -->
                        <li class="list-group-item">Contact 1</li>
                        <li class="list-group-item">Contact 2</li>
                        <li class="list-group-item">Contact 3</li>
                        <!-- Add more contacts as needed -->
                    </ul>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        Chat with Contact
                    </div>
                    <div class="card-body" id="message-box">
                        <!-- Messages will be displayed here -->
                    </div>
                    <div class="card-footer">
                        <div class="input-group">
                            <input type="text" id="message-input" class="form-control"
                                   placeholder="Type your message...">
                            <div class="input-group-append">
                                <button id="send-button" class="btn btn-primary">Send</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
<script>
    // Function to create a WebSocket connection
    function connectWebSocket(roomName) {
        const socket = new WebSocket(`ws://localhost:8002/ws/chat/${roomName}/`);

        // Handle WebSocket events
        socket.onopen = (event) => {
            console.log("WebSocket connection opened:", event);
        };

        socket.onmessage = (event) => {
            const messageData = JSON.parse(event.data);
            const messageBox = document.getElementById("message-box");
            const message = messageData.message;
            const sender = messageData.sender;

            // Display the received message in the message box
            messageBox.innerHTML += `<p><strong>${sender}:</strong> ${message}</p>`;
        };

        socket.onclose = (event) => {
            console.log("WebSocket connection closed:", event);
        };

        // Function to send a message through the WebSocket
        function sendMessage() {
            const messageInput = document.getElementById("message-input");
            const message = messageInput.value;

            if (message) {
                // Send the message to the WebSocket server
                socket.send(JSON.stringify({ message: message }));

                // Display the sent message in the message box
                const messageBox = document.getElementById("message-box");
                messageBox.innerHTML += `<p><strong>You:</strong> ${message}</p>`;

                // Clear the input field
                messageInput.value = "";
            }
        }

        // Attach the sendMessage function to the send button
        const sendButton = document.getElementById("send-button");
        sendButton.addEventListener('click', sendMessage);
    }

    // Add event listeners to the contact list items
    const contactItems = document.querySelectorAll('.list-group-item');
    contactItems.forEach((contactItem) => {
        contactItem.addEventListener('click', () => {
            const roomName = contactItem.innerText;  // Use the contact's name as the room name
            connectWebSocket(roomName);
        });
    });
</script>
{% endblock  %}
